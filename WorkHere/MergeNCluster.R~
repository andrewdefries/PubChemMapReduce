#!/usr/bin/env Rscript
###################
library(ChemmineR)
library(parallel)
###################
ncores<-system("nproc")
#
sdfset_files<-list.files(pattern="Compound*")
apset_files<-list.files(pattern="Compound*")
#
MergeWork<-function(b){
#
load(apset_files[b])
apset_a<-apset
rm(apset)
load("DrugBank_approved_apset.rda")
apset_b<-apset
rm(apset)
##
splitVal<-500
##
apset_increment<-seq(1,length(apset_a),splitVal)
##
##
for (i in apset_increment){
#
#apset<-c(apset_a[, apset_b)
#
apset<-c(apset_a[i:i+1], apset_b)
cluster<-cmp.cluster(apset, cutoff=c(0.2))
#
if (match(cluster$ids,cid(apset))==1){
#subset(cluster,match(cluster$ids,saveList)==1)
#if (cluster$id[cluster$id=="DB09008"]>1){
#if (cid(apset_a)%in%cluster$ids){
#add i to increment
save(cluster, file=paste("group_", i, "_", gsub("_apset.rda", "_cluster_w_approved.rda", apset_files[b]), sep=""), compress=T)
#
}else{}
####
}
##
#if input sdf does not group with any db compounds break
#else save cluster file for combine step
##
}
b<-1:length(sdfset_files)
mclapply(b, MergeWork, mc.cores=ncores)
